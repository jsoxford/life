<html>
<head>
  <title>Life</title>
  <style type="text/css">
    body{
      margin:0;
    }
  </style>
</head>
<body>
  <canvas id="world" width="500" height="500"></canvas>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    var width = 20, height = 20;

    var socket = io();
    var ctx = world.getContext('2d');
    ctx.scale(world.width/width,world.height/height);

    socket.on('state', function(data){
      for(var x = 0; x < width; x++){
        for(var y = 0; y < height; y++){
          ctx.fillStyle = data.world[x + (width*y)] ? '#fff' : '#000';
          ctx.fillRect(x,y,1,1);
        }
      }
    });



    var lastI;

    world.addEventListener('mousemove', function(e){
      console.log(e);
      var x = Math.floor((e.pageX/world.width)*width),
          y = Math.floor((e.pageY/world.height)*height);

      if(lastI!=(x + (y*width))){
        lastI=(x + (y*width))

        socket.emit('on', [x,y]);

        ctx.fillStyle = '#ccc'
        ctx.fillRect(x,y,1,1);

      }
    }, false)

  </script>
</body>
</html>
